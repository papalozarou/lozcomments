// -----------------------------------------------------------------------------
// loznotes is a notation layer for conveying information about wireframes, 
// mockups and design comps. Originally a fork, this now a complete rewrite of 
// Elliance's excellent Metaframe work (http://github.com/elliance/metaframe).
//
// ©2013-2014 Loz Gray – Creative Commons Attribution Sharealike 3.0 Unported 
// http://creativecommons.org/licenses/by-sa/3.0/
//
// Dependancies:
//
// jquery 2.x.x
// loznotes.css
// -----------------------------------------------------------------------------
var loznotes=function(){function c(){h();e=$("[data-notation]");p();d();b();i=$(".loznotes__anchor a");s=$(".loznote__count")}function h(){$(".loznotes__tab-pane").length>0&&$(".loznotes__anchor").add(".loznotes__tab-control").add(".loznotes__tab-pane").remove()}function p(){if($("body").data("notation")){t=$(e[0]);e=e.splice(1)}}function d(){v();r=$("<section/>",{"class":"loznotes__tab-pane"}).appendTo("body");r.html("<h1>"+document.title+"</h1>");m();g();y()}function v(){n=$("<a/>",{"class":"loznotes__tab-control",href:"#"}).appendTo("body")}function m(){var e=$('<form class="loznotes__form"><input type="checkbox" id="loznotes__form__display-toggle" />Show note markers</form><h2>Page Notes</h2>');e.appendTo(r)}function g(){t&&r.append('<p class="loznotes__page-description">'+t.data("notation")+"</p>")}function y(){var t=$("<dl/>",{"class":"loznotes__list"});for(var n=0;n<e.length;n++)t.append('<dt id= "loznote--'+(n+1)+'" class="loznote__count loznote__count-'+(n+1)+'">'+(n+1)+"</dt>"+'<dd class="loznote__body loznote__body-'+(n+1)+'">'+$(e[n]).data("notation")+"</dd>");t.appendTo(r)}function b(){for(var t=0;t<e.length;t++)$(e[t]).prepend('<figure class="loznotes__anchor"><a href="#loznote--'+(t+1)+'">'+(t+1)+"</a></figure>")}function w(){i.parent().addClass(o)}function E(){$(i).click(function(e){T(this);e.preventDefault()})}function S(){$(n).click(function(e){var t=$(".loznotes__anchor--is-selected a");t&&C(t);A();r.scrollTop(0);e.preventDefault()})}function x(){$("#loznotes__form__display-toggle").click(function(){i.parent().toggleClass(o)})}function T(e){var t=$(".loznotes__anchor--is-selected a"),n=e.hash;if(t[0])if($(e).parent().hasClass(u)){C();L();r.scrollTop(0)}else{C();N(e);k();O(n)}else{N(e);k();O(n)}}function N(e){$(e).parent().addClass(u);$(e.hash).addClass(a)}function C(){i.parent().removeClass(u);s.removeClass(a)}function k(){n.addClass(f);r.addClass(l)}function L(){n.removeClass(f);r.removeClass(l)}function A(){n.toggleClass(f);r.toggleClass(l)}function O(e){e==="#loznote--1"?r.scrollTop(0):r.scrollTop($(e).position().top-20)}function M(){var e=window.location.search.substring(1).split("&");if($.inArray("loznotes=hidden",e)>-1||$.inArray("loznotes=hide",e)>-1){c();w();E();S();x()}else{if($.inArray("loznotes=off",e)>-1)return!1;c();E();S();x();$("#loznotes__form__display-toggle").attr("checked","checked")}}var e,t,n,r,i,s,o="loznotes__anchor--is-hidden",u="loznotes__anchor--is-selected",a="loznote__count--is-selected",f="loznotes__tab-control--is-active",l="loznotes__tab-pane--is-active";return{checkSubstring:M}}();loznotes.checkSubstring();$(document).ajaxComplete(function(){loznotes.checkSubstring()});