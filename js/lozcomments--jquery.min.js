// generate new firebase data container based on page title attribute
function createCommentForm(e){commentFormName='<input type="text" placeholder="Name" class="lozcomments__form__author lozcomments__form-'+e+'__author" />';commentFormMessage='<textarea rows="4" placeholder="Comment" class="lozcomments__form__message lozcomments__form-'+e+'__message"></textarea>';commentFormSubmit='<input type="submit" class="lozcomments__form__submit lozcomments__form-'+e+'__submit" value="Comment" /><input type="button" class="lozcomments__form__cancel lozcomments__form-'+e+'__cancel" value="Cancel" />';commentForm='<form method="post" class="lozcomments__form lozcomments__form-'+e+'">'+commentFormName+commentFormMessage+commentFormSubmit+"</form>";return commentForm}function formatCommentString(e){var t=/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,n=/((www|(https?|ftp|file):\/\/)[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,r=/(@([A-Za-z]+[A-Za-z0-9]+))/ig;e=e.replace(t,"$1<br />$2");e=e.replace(n,'<a href="$1" class="lozcomment__message-body__link">$1</a>');e=e.replace(r,'<mark class="lozcomment__message-body__mention">$1</mark>');return e}var firebaseBaseURL="https://blinding-fire-4499.firebaseio.com/",firebaseNewContainer=document.title.replace(/\W/g,"-").toLowerCase(),firebaseURL=firebaseBaseURL+firebaseNewContainer+"-comments",fb=new Firebase(firebaseURL),fbChild,commentForm,commentFormName,commentFormMessage,commentFormSubmit,commentableElements=$("[data-comments]");for(var i=commentableElements.length-1;i>=0;i--){commentForm=createCommentForm(i+1);$(commentableElements[i]).prepend('<div id="lozcomments__comments-'+(i+1)+'" class="lozcomments__comments lozcomments__comments--is-inactive"><div class="lozcomments__container"><dl class="lozcomments__thread lozcomments__thread-'+(i+1)+'"></dl>'+commentForm+"</div></div>");$(commentableElements[i]).prepend('<figure class="lozcomments__anchor lozcomments__anchor-'+(i+1)+'">Comment<a href="#lozcomments__comments-'+(i+1)+'"></a></figure>')}commentFormSubmit=$(".lozcomments__form__submit");commentFormSubmit.click(function(e){var t="/"+$(this).closest("[data-comments]").data("comments"),n=firebaseURL+t;fbChild=new Firebase(n);var r=$(this).siblings(".lozcomments__form__author"),i=$(this).siblings(".lozcomments__form__message"),s=r.val(),o=i.val();console.log(s,o);if(s!==""&&o!==""){r.removeClass("lozcomments__form__author--has-error");i.removeClass("lozcomments__form__message--has-error");fbChild.push({author:s,message:o})}else if(s===""&&o===""){r.addClass("lozcomments__form__author--has-error");i.addClass("lozcomments__form__message--has-error")}else if(s===""){r.addClass("lozcomments__form__author--has-error");i.removeClass("lozcomments__form__message--has-error")}else if(o===""){i.addClass("lozcomments__form__message--has-error");r.removeClass("lozcomments__form__author--has-error")}i.val("");e.preventDefault()});fb.on("child_added",function(e){e.ref().on("child_added",function(e,t){var n=e.val(),r="#lozcomments__"+e.ref().parent().name()+" .lozcomments__thread",i=formatCommentString(n.message);$(r).append('<dt class="lozcomment__author">'+n.author+"</dt");$(r).append('<dd class="lozcomment__message">'+i+"</dd>")})});$(".lozcomments__anchor a").click(function(e){$(".lozcomments__anchor").removeClass("lozcomments__anchor--is-selected").filter($(this).parent()).addClass("lozcomments__anchor--is-selected");$(".lozcomments__comments").removeClass("lozcomments__comments--is-active").addClass("lozcomments__comments--is-inactive").filter(this.hash).addClass("lozcomments__comments--is-active").removeClass("lozcomments__comments--is-inactive");e.preventDefault()});$(".lozcomments__form__cancel").click(function(e){console.log("clicked",$(this).closest(".lozcomments__comments"));$(this).closest(".lozcomments__comments").removeClass("lozcomments__comments--is-active").addClass("lozcomments__comments--is-inactive").prev(".lozcomments__anchor").removeClass("lozcomments__anchor--is-selected");e.preventDefault()});$(".lozcomments__thread").bind("mousewheel DOMMouseScroll",function(e){var t=e.originalEvent,n=t.wheelDelta||-t.detail;this.scrollTop+=(n<0?1:-1)*30;e.preventDefault()});